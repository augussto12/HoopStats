<div class="league-table-container">

    <h2 class="title">Ligas disponibles</h2>

    <div class="league-table-wrapper">

        <table class="league-table">

            <thead>
                <tr>
                    <th>Creador</th>
                    <th>Nombre</th>
                    <th>Usuarios</th>
                    <th>Privacidad</th>
                    <th>Acción</th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let l of leagues" (click)="openDetails(l.id)">

                    <td data-label="Creador">
                        {{ l.creator_username }}
                    </td>

                    <td data-label="Nombre">
                        {{ l.name }}
                    </td>

                    <td data-label="Usuarios">
                        <span class="users-badge" [class.green]="l.max_teams === null || l.current_users < l.max_teams"
                            [class.red]="l.max_teams !== null && l.current_users >= l.max_teams">
                            {{ l.current_users }} / {{ l.max_teams || '∞' }}
                        </span>
                    </td>

                    <td data-label="Privacidad">
                        <span class="badge" [class.public]="l.privacy === 'public'"
                            [class.private]="l.privacy === 'private'">
                            {{ l.privacy === 'public' ? 'Pública' : 'Privada' }}
                        </span>
                    </td>

                    <td data-label="Acción" class="action-cell" (click)="$event.stopPropagation()">

                        <!-- ADMINISTRADOR -->
                        <button *ngIf="isAdmin(l)" class="admin-btn" (click)="manageLeague(l.id)">
                            Administrar
                        </button>

                        <!-- MIEMBRO (NO ADMIN) -->
                        <button *ngIf="isMember(l) && !isAdmin(l)" class="leave-btn" (click)="leaveLeague(l.id)">
                            Abandonar liga
                        </button>

                        <!-- NO soy miembro → pública -->
                        <button *ngIf="!isMember(l) && l.privacy === 'public'" class="join-btn"
                            [disabled]="loadingReq[l.id]" (click)="requestJoin(l.id)">
                            Unirse
                        </button>

                        <!-- NO soy miembro → privada -->
                        <button *ngIf="!isMember(l) && l.privacy === 'private'" class="request-btn"
                            [disabled]="loadingReq[l.id]" (click)="requestJoin(l.id)">
                            Solicitar acceso
                        </button>

                    </td>

                </tr>
            </tbody>

        </table>

    </div>

</div>

<!-- ============================
            MODAL LEAVE LEAGUE
============================= -->
<div class="modal-backdrop" *ngIf="leaveModalLeagueId">
    <div class="modal-box">

        <h3 class="modal-title">Abandonar liga</h3>

        <p class="modal-message">
            ¿Seguro que querés abandonar esta liga?<br>
            Ya no vas a aparecer en la tabla de posiciones ni podrás volver sin invitación si es privada.
        </p>

        <div class="modal-buttons">
            <button class="cancel-btn" (click)="closeLeaveModal()">Cancelar</button>

            <button class="confirm-btn danger" (click)="confirmLeaveLeague()">
                Abandonar
            </button>
        </div>

    </div>
</div>