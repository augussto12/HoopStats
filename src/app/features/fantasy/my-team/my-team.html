<div *ngIf="!loadingTeam">

    <div *ngIf="team; else createTeam" class="fantasy-team">

        <!-- HEADER DEL EQUIPO -->
        <div class="team-header">
            <div class="team-row">
                <h2>{{ team.name }}</h2>
                <button (click)="editingName = true">Editar nombre</button>
            </div>

            <div *ngIf="editingName" class="edit-name">
                <input type="text" [(ngModel)]="newName" placeholder="Nuevo nombre" />
                <button (click)="saveName()">Guardar</button>
            </div>

            <div class="team-stats">
                <span>Presupuesto: <strong>{{ team.budget }}</strong></span>
                <span>Puntos totales: <strong>{{ team.total_points }}</strong></span>
            </div>
        </div>

        <!-- MENSAJES -->
        <p class="success" *ngIf="success">{{ success }}</p>
        <p class="error" *ngIf="error">{{ error }}</p>

        <!-- CANCHA -->
        <div class="court">
            <h3 class="court-title">Mi alineaci√≥n</h3>

            <div class="court-grid">
                <div class="slot" *ngFor="let p of players">
                    <div class="player-data">

                        <strong class="player-name">{{ p.full_name }}</strong>
                        <p class="player-price">üí∞ {{ p.price }} cr√©ditos</p>
                        <p class="player-pts">üèÄ {{ p.total_pts }} pts</p>

                        <button class="remove-btn" (click)="removePlayer(p.player_id)"
                            [disabled]="liveGames.length > 0">
                            Cambiar
                        </button>

                    </div>
                </div>
            </div>
        </div>

        <p class="error" *ngIf="liveGames.length > 0">
            No se puede modificar el equipo mientras hay partidos en vivo
        </p>

        <button class="toggle-add" (click)="toggleAddForm()" [disabled]="liveGames.length > 0">
            {{ showAddForm ? 'Cerrar' : 'Agregar jugador' }}
        </button>


        <!-- FORMULARIO PARA AGREGAR JUGADORES -->
        <div *ngIf="showAddForm" class="add-form">

            <!-- FILTROS -->
            <div class="options-row">

                <div class="option">
                    <label>Equipo</label>
                    <select [(ngModel)]="selectedTeam" (change)="filterPlayers()" class="select">
                        <option [ngValue]="null">Todos</option>
                        <option *ngFor="let t of nbaTeams" [value]="t.id">
                            {{ t.name }}
                        </option>
                    </select>
                </div>

                <div class="option">
                    <label>Precio (rangos)</label>
                    <select [(ngModel)]="selectedRange" (change)="filterPlayers()" class="select">
                        <option [ngValue]="null">Todos</option>
                        <option *ngFor="let r of priceRanges" [ngValue]="r">
                            {{ r.label }}
                        </option>
                    </select>
                </div>

                <div class="option">
                    <label>Precio exacto</label>
                    <input type="number" class="select" min="0" [(ngModel)]="exactPrice" (input)="filterPlayers()" />
                </div>

            </div>

            <div class="players-grid" *ngIf="paginatedPlayers.length > 0">
                <div class="player-card selectable" *ngFor="let p of paginatedPlayers">
                    <h4>{{ p.full_name }}</h4>
                    <p>Precio: {{ p.price }}</p>
                    <button (click)="addPlayer(p.id)">Agregar</button>
                </div>
            </div>

            <div class="pagination" *ngIf="totalPages > 1">

                <button (click)="currentPage = currentPage - 1" [disabled]="currentPage === 1">
                    ‚óÄ Anterior
                </button>

                <span>P√°gina {{ currentPage }} / {{ totalPages }}</span>

                <button (click)="currentPage = currentPage + 1" [disabled]="currentPage === totalPages">
                    Siguiente ‚ñ∂
                </button>

            </div>

        </div>
    </div>

    <!-- CREAR EQUIPO -->
    <ng-template #createTeam>
        <div class="fantasy-team create">
            <h2>Crear tu equipo</h2>

            <input type="text" [(ngModel)]="newName" placeholder="Nombre del equipo" />

            <button (click)="saveName()">Crear equipo</button>

            <p class="error" *ngIf="error">{{ error }}</p>
        </div>
    </ng-template>

</div>